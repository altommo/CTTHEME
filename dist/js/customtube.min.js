!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CustomTube=t():e.CustomTube=t()}(this,(function(){return function(){"use strict";var e={d:function(t,s){for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t={};e.d(t,{default:function(){return w}});class s{constructor(e={}){this.config={ajaxUrl:e.ajaxUrl||window.customtubeData?.ajaxurl||"/wp-admin/admin-ajax.php",nonce:e.nonce||window.customtubeData?.nonce||"",debug:e.debug||window.customtubeData?.debug||!1,...e}}async request(e={}){const t={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},credentials:"same-origin",...e};t.body instanceof URLSearchParams&&!t.body.has("nonce")&&t.body.append("nonce",this.config.nonce);try{this.config.debug;const e=await fetch(this.config.ajaxUrl,t);if(!e.ok){const t=await e.text();throw new Error(`HTTP error! status: ${e.status}, response: ${t}`)}const s=await e.json();return this.config.debug,s}catch(e){throw e}}createParams(e){const t=new URLSearchParams;for(const[s,i]of Object.entries(e))Array.isArray(i)?i.forEach((e=>t.append(`${s}[]`,e))):t.append(s,i);return t}async updateViewCount(e){const t=this.createParams({action:"customtube_update_view_count",post_id:e,nonce:this.config.nonce});return this.request({body:t,action:"updateViewCount"})}async toggleLike(e){const t=this.createParams({action:"customtube_toggle_like",post_id:e,nonce:this.config.nonce});return this.request({body:t,action:"toggleLike"})}async getFilteredVideos(e={}){const t=this.createParams({action:"customtube_filter_videos",...e,nonce:this.config.nonce});return this.request({body:t,action:"getFilteredVideos"})}async loadMoreVideos(e,t={}){const s=this.createParams({action:"customtube_load_more_videos",page:e,...t,nonce:this.config.nonce});return this.request({body:s,action:"loadMoreVideos"})}async getTrendingVideos(e={}){const t=this.createParams({action:"get_trending_videos",...e,nonce:this.config.nonce});return this.request({body:t,action:"getTrendingVideos"})}async getLikedVideos(e={}){const t=this.createParams({action:"get_liked_videos",...e,nonce:this.config.nonce});return this.request({body:t,action:"getLikedVideos"})}async getShortVideos(e={}){const t=this.createParams({action:"get_short_videos",...e,nonce:this.config.nonce});return this.request({body:t,action:"getShortVideos"})}async userLogin(e,t,s=!1){const i=this.createParams({action:"custom_user_login",log:e,pwd:t,rememberme:s?"1":"0",nonce:this.config.nonce});return this.request({body:i,action:"userLogin"})}async userRegister(e){const t=this.createParams({action:"custom_user_register",...e,nonce:this.config.nonce});return this.request({body:t,action:"userRegister"})}async search(e,t={}){const s=this.createParams({action:"customtube_search",query:e,...t,nonce:this.config.nonce});return this.request({body:s,action:"search"})}async getRecommendations(e,t=8){const s=this.createParams({action:"get_video_recommendations",video_id:e,count:t,nonce:this.config.nonce});return this.request({body:s,action:"getRecommendations"})}async getPersonalizedRecommendations(e=[],t=5,s="hero"){const i=this.createParams({action:"customtube_ajax_get_personalized_recommendations",watched_video_ids:e,limit:t,type:s,nonce:this.config.nonce});return this.request({body:i,action:"getPersonalizedRecommendations"})}async trackUserBehavior(e,t){const s=this.createParams({action:"customtube_track_user_behavior",video_id:e,event_type:t,nonce:this.config.nonce});return this.request({body:s,action:"trackUserBehavior"})}async wp(e,t={}){const s=this.createParams({action:e,...t,nonce:this.config.nonce});return this.request({body:s,action:e})}}new s;const i=(e,t)=>{let s;return function(...i){clearTimeout(s),s=setTimeout((()=>{clearTimeout(s),e(...i)}),t)}},o=(e,t)=>{let s;return function(){const i=arguments,o=this;s||(e.apply(o,i),s=!0,setTimeout((()=>s=!1),t))}},a=e=>{const t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));return t?t[2]:null},n=(e,t,s)=>{let i="";if(s){const e=new Date;e.setTime(e.getTime()+24*s*60*60*1e3),i="; expires="+e.toUTCString()}document.cookie=e+"="+t+i+"; path=/"},r=e=>{const t=Math.floor(e/3600),s=Math.floor(e%3600/60),i=Math.floor(e%60);return t>0?`${t}:${s.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`:`${s}:${i.toString().padStart(2,"0")}`},l=(e,t,s,i={})=>(e.addEventListener(t,s,i),()=>{e.removeEventListener(t,s,i)}),c=e=>{const t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)};class d{constructor(){this.config={ajaxUrl:window.customtubeData?.ajaxurl||"/wp-admin/admin-ajax.php",nonce:window.customtubeData?.nonce||"",debug:window.customtubeData?.debug||!1,version:window.customtubeData?.css_version||"1.0.0"},this.ajax=new s(this.config),this.state={isInitialized:!1,currentPage:this.getCurrentPage(),isMobile:this.isMobileDevice(),components:new Map},this.events=new EventTarget}init(){this.state.isInitialized||(this.setupErrorHandling(),this.config.debug&&this.setupPerformanceMonitoring(),this.setupGlobalMethods(),this.setupResponsiveDetection(),this.state.isInitialized=!0,this.emit("core:initialized",this.state))}registerComponent(e,t){this.state.components.set(e,t),this.emit("component:registered",{name:e,component:t})}getComponent(e){return this.state.components.get(e)||null}emit(e,t=null){this.events.dispatchEvent(new CustomEvent(e,{detail:t}))}on(e,t){this.events.addEventListener(e,t)}off(e,t){this.events.removeEventListener(e,t)}getCurrentPage(){const e=document.body;return e.classList.contains("home")?"home":e.classList.contains("single-video")?"video-single":e.classList.contains("page-template-performers")?"performers":e.classList.contains("page-template-login")?"login":e.classList.contains("page-template-register")?"register":e.classList.contains("page-template-likedvideos")?"liked-videos":e.classList.contains("page-template-shorties")?"short-videos":e.classList.contains("archive")?"archive":e.classList.contains("search")?"search":"default"}isMobileDevice(){return window.innerWidth<=768||/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}setupErrorHandling(){window.addEventListener("error",(e=>{this.config.debug,this.emit("error:global",{type:"javascript",message:e.message,source:e.filename,line:e.lineno,column:e.colno})})),window.addEventListener("unhandledrejection",(e=>{this.config.debug,this.emit("error:promise",{type:"promise",reason:e.reason})}))}setupPerformanceMonitoring(){window.addEventListener("load",(()=>{setTimeout((()=>{performance.getEntriesByType("navigation")[0]}),0)}));new PerformanceObserver((e=>{for(const t of e.getEntries())t.name.includes("customtube")||t.name.includes(".js")||t.name.includes(".css")})).observe({entryTypes:["resource"]})}setupGlobalMethods(){window.customtubeDebounce=i,window.customtubeThrottle=o,window.customtubeAjax=this.ajax,window.customtubeEvents={emit:this.emit.bind(this),on:this.on.bind(this),off:this.off.bind(this)}}setupResponsiveDetection(){const e=()=>{const e=window.innerWidth,t=this.state.currentBreakpoint;this.state.currentBreakpoint=e<576?"xs":e<768?"sm":e<992?"md":e<1200?"lg":"xl",this.state.isMobile=e<=768,t!==this.state.currentBreakpoint&&this.emit("breakpoint:changed",{from:t,to:this.state.currentBreakpoint,width:e,isMobile:this.state.isMobile})};e(),window.addEventListener("resize",i(e,100))}waitForElement(e,t=1e4){return new Promise(((s,i)=>{const o=document.querySelector(e);if(o)return void s(o);const a=new MutationObserver((()=>{const t=document.querySelector(e);t&&(a.disconnect(),s(t))}));a.observe(document.body,{childList:!0,subtree:!0}),setTimeout((()=>{a.disconnect(),i(new Error(`Element ${e} not found within ${t}ms`))}),t)}))}cleanup(){for(const[e,t]of this.state.components)t&&"function"==typeof t.cleanup&&t.cleanup();this.state.components.clear(),this.state.isInitialized=!1,this.emit("core:cleanup")}}class h{constructor(e){this.core=e,this.elements={},this.state={isMobileMenuOpen:!1,activeDropdown:null,isUserMenuOpen:!1},this.events=[]}init(){this.cacheElements(),this.setupEventListeners(),this.ensureMobileMenuCollapsed(),this.setupStickyHeader(),this.core.registerComponent("navigation",this)}cacheElements(){this.elements={nav:document.querySelector(".site-header"),burger:document.querySelector(".menu-toggle"),mobileOverlay:document.querySelector(".mobile-menu-overlay"),mobileMenu:document.querySelector(".mobile-menu-panel"),userAvatar:document.querySelector(".user-profile"),userDropdown:document.querySelector(".user-menu-dropdown"),searchField:document.querySelector(".header-search .search-field"),themeToggle:document.querySelector(".dark-mode-toggle"),headerAd:document.querySelector(".tube-ads-header")},this.elements.secondaryNavDropdowns=document.querySelectorAll(".secondary-nav .has-dropdown"),this.elements.mobileDropdowns=document.querySelectorAll(".mobile-menu-list .has-dropdown")}_addEvent(e,t,s,i={}){e&&(e.addEventListener(t,s,i),this.events.push({element:e,eventType:t,handler:s}))}setupEventListeners(){this.elements.burger&&this._addEvent(this.elements.burger,"click",this.handleMobileMenuToggle.bind(this)),this.elements.mobileOverlay&&this._addEvent(this.elements.mobileOverlay,"click",this.closeMobileMenu.bind(this)),this.elements.secondaryNavDropdowns.forEach((e=>{this.setupSecondaryNavDropdown(e)})),this.elements.mobileDropdowns.forEach((e=>{this.setupMobileDropdown(e)})),this.elements.userProfile&&this._addEvent(this.elements.userProfile,"click",this.handleUserMenuToggle.bind(this)),this.elements.searchField&&this._addEvent(this.elements.searchField,"input",i(this.handleSearch.bind(this),300)),this._addEvent(document,"keydown",this.handleKeydown.bind(this)),this._addEvent(document,"click",this.handleGlobalClick.bind(this)),this._addEvent(window,"resize",i(this.handleResize.bind(this),100))}setupSecondaryNavDropdown(e){const t=e.querySelector("a"),s=e.querySelector(".dropdown-menu");if(!t||!s)return;this._addEvent(t,"click",(i=>{i.preventDefault(),i.stopPropagation(),e.classList.contains("is-active")?this.closeSecondaryNavDropdown(e,t,s):(this.elements.secondaryNavDropdowns.forEach((t=>{t!==e&&t.classList.contains("is-active")&&this.closeSecondaryNavDropdown(t,t.querySelector("a"),t.querySelector(".dropdown-menu"))})),this.openSecondaryNavDropdown(e,t,s))}))}openSecondaryNavDropdown(e,t,s){e.classList.add("is-active"),s.style.display="flex",t.setAttribute("aria-expanded","true"),this.state.activeDropdown=e,this.core.emit("navigation:secondary-dropdown-opened",e)}closeSecondaryNavDropdown(e,t,s){e.classList.remove("is-active"),s.style.display="none",t.setAttribute("aria-expanded","false"),this.state.activeDropdown===e&&(this.state.activeDropdown=null),this.core.emit("navigation:secondary-dropdown-closed",e)}setupMobileDropdown(e){const t=e.querySelector("[data-mobile-dropdown-toggle]")||e.querySelector("a"),s=e.querySelector(".mobile-submenu");if(!t||!s)return;this._addEvent(t,"click",(i=>{i.preventDefault(),i.stopPropagation();const o=e.classList.contains("is-open");this.elements.mobileDropdowns.forEach((t=>{if(t!==e){t.classList.remove("is-open");const e=t.querySelector(".mobile-submenu");e&&(e.style.display="none")}})),o?(e.classList.remove("is-open"),s.style.display="none",t.setAttribute("aria-expanded","false")):(e.classList.add("is-open"),s.style.display="block",t.setAttribute("aria-expanded","true"))}))}handleMobileMenuToggle(e){e.preventDefault(),e.stopPropagation(),this.state.isMobileMenuOpen?this.closeMobileMenu():this.openMobileMenu()}openMobileMenu(){this.elements.mobileMenu&&this.elements.mobileOverlay&&(this.state.isMobileMenuOpen=!0,this.elements.mobileOverlay&&this.elements.mobileOverlay.classList.add("is-active"),this.elements.mobileMenu&&this.elements.mobileMenu.classList.add("is-active"),document.body.classList.add("mobile-menu-open"),document.body.style.overflow="hidden",this.elements.burger&&(this.elements.burger.setAttribute("aria-expanded","true"),this.elements.burger.setAttribute("data-mobile-menu-closed","false")),this.core.emit("navigation:mobile-menu-opened"))}closeMobileMenu(){this.elements.mobileMenu&&this.elements.mobileOverlay&&(this.state.isMobileMenuOpen=!1,this.elements.mobileOverlay&&this.elements.mobileOverlay.classList.remove("is-active"),this.elements.mobileMenu&&this.elements.mobileMenu.classList.remove("is-active"),document.body.classList.remove("mobile-menu-open"),document.body.style.overflow="",this.elements.burger&&(this.elements.burger.setAttribute("aria-expanded","false"),this.elements.burger.setAttribute("data-mobile-menu-closed","true")),this.elements.mobileDropdowns.forEach((e=>{e.classList.remove("is-open");const t=e.querySelector(".mobile-submenu");t&&(t.style.display="none")})),this.core.emit("navigation:mobile-menu-closed"))}ensureMobileMenuCollapsed(){this.closeMobileMenu()}handleUserMenuToggle(){this.state.isUserMenuOpen?this.closeUserMenu():this.openUserMenu()}openUserMenu(){this.elements.userAvatar&&this.elements.userDropdown&&(this.state.isUserMenuOpen=!0,this.elements.userAvatar.classList.add("is-active"),this.elements.userDropdown.classList.add("is-active"),this.elements.userAvatar.setAttribute("aria-expanded","true"),this.core.emit("navigation:user-menu-opened"))}closeUserMenu(){this.elements.userAvatar&&this.elements.userDropdown&&(this.state.isUserMenuOpen=!1,this.elements.userAvatar.classList.remove("is-active"),this.elements.userDropdown.classList.remove("is-active"),this.elements.userAvatar.setAttribute("aria-expanded","false"),this.core.emit("navigation:user-menu-closed"))}handleSearch(e){const t=e.target.value.trim();t.length>2&&this.core.emit("navigation:search",{query:t})}handleKeydown(e){"Escape"===e.key&&(this.closeMobileMenu(),this.closeUserMenu(),this.elements.secondaryNavDropdowns.forEach((e=>{e.classList.contains("is-active")&&this.closeSecondaryNavDropdown(e,e.querySelector("a"),e.querySelector(".dropdown-menu"))})))}handleGlobalClick(e){!this.state.isUserMenuOpen||this.elements.userAvatar?.contains(e.target)||this.elements.userDropdown?.contains(e.target)||this.closeUserMenu(),this.elements.secondaryNavDropdowns.forEach((t=>{t.classList.contains("is-active")&&!t.contains(e.target)&&this.closeSecondaryNavDropdown(t,t.querySelector("a"),t.querySelector(".dropdown-menu"))}))}handleResize(){window.innerWidth>=1024&&this.state.isMobileMenuOpen&&this.closeMobileMenu()}setupStickyHeader(){const e=this.elements.nav;this.elements.headerAd;if(!e)return;let t=0,s=!1;const i=()=>{const i=window.pageYOffset||document.documentElement.scrollTop;if(i>10?e.classList.add("is-scrolled"):e.classList.remove("is-scrolled"),Math.abs(t-i)<=5)return t=i,void(s=!1);const o=document.querySelector(".header-stack");if(!o)return;const a=o.offsetHeight;i>t&&i>a?o.classList.add("is-hidden"):i<t&&o.classList.remove("is-hidden"),t=i,s=!1};this._addEvent(window,"scroll",(()=>{s||(requestAnimationFrame(i),s=!0)}),{passive:!0})}cleanup(){this.events.forEach((({element:e,eventType:t,handler:s})=>{e&&e.removeEventListener(t,s)})),this.events=[],this.state={isMobileMenuOpen:!1,activeDropdown:null,isUserMenuOpen:!1}}}class u{constructor(e){this.core=e,this.elements={},this.events=[],this.currentTheme="dark"}init(){this.cacheElements(),this.applyInitialTheme(),this.setupEventListeners(),this.setupSystemPreferenceListener(),this.core.registerComponent("themeSwitcher",this)}cacheElements(){this.elements={toggleButtons:document.querySelectorAll(".ph-nav__theme-toggle, #theme-toggle"),body:document.body,html:document.documentElement}}setupEventListeners(){this.elements.toggleButtons.forEach((e=>{this.events.push(l(e,"click",this.handleThemeToggle.bind(this)))}))}handleThemeToggle(e){e.preventDefault();const t="dark"===this.currentTheme?"light":"dark";this.setTheme(t),this.core.emit("theme:changed",{from:"dark"===this.currentTheme?"light":"dark",to:t})}applyInitialTheme(){const e=a("dark_mode");let t="dark";e?t=e:window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches&&(t="light"),this.setTheme(t)}setTheme(e){["dark","light"].includes(e)||(e="dark"),this.currentTheme=e,this.elements.html.setAttribute("data-current-mode",e),this.elements.body.setAttribute("data-theme",e),this.elements.body.classList.toggle("dark-mode","dark"===e),this.updateToggleButtons(e),n("dark_mode",e,30),this.core.emit("theme:applied",{theme:e}),this.core.config.debug}updateToggleButtons(e){this.elements.toggleButtons.forEach((t=>{t.setAttribute("data-current-mode",e);const s=t.querySelector(".theme-icon--sun"),i=t.querySelector(".theme-icon--moon");s&&i&&("light"===e?(s.style.display="block",i.style.display="none"):(s.style.display="none",i.style.display="block"));const o=t.querySelector(".theme-toggle-text");o&&(o.textContent="dark"===e?"Light Mode":"Dark Mode")}))}getCurrentTheme(){return this.currentTheme}toggle(){const e="dark"===this.currentTheme?"light":"dark";this.setTheme(e)}setupSystemPreferenceListener(){if(window.matchMedia){const e=window.matchMedia("(prefers-color-scheme: dark)"),t=e=>{if(!a("dark_mode")){const t=e.matches?"dark":"light";this.setTheme(t),this.core.emit("theme:system-preference-changed",{systemPreference:t})}};e.addEventListener?e.addEventListener("change",t):e.addListener(t),this.systemPreferenceQuery=e,this.systemPreferenceHandler=t}}forceTheme(e){const t=this.currentTheme;this.currentTheme=e,this.elements.html.setAttribute("data-current-mode",e),this.elements.body.setAttribute("data-theme",e),this.elements.body.classList.toggle("dark-mode","dark"===e),this.updateToggleButtons(e),this.core.emit("theme:forced",{from:t,to:e})}resetToDefault(){n("dark_mode","",-1);let e="dark";window.matchMedia&&window.matchMedia("(prefers-color-scheme: light)").matches&&(e="light"),this.setTheme(e),this.core.emit("theme:reset",{theme:e})}isDarkMode(){return"dark"===this.currentTheme}isLightMode(){return"light"===this.currentTheme}getSystemPreference(){return window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":window.matchMedia("(prefers-color-scheme: light)").matches?"light":"no-preference":"no-preference"}cleanup(){this.events.forEach((e=>e())),this.events=[],this.systemPreferenceQuery&&this.systemPreferenceHandler&&(this.systemPreferenceQuery.removeEventListener?this.systemPreferenceQuery.removeEventListener("change",this.systemPreferenceHandler):this.systemPreferenceQuery.removeListener(this.systemPreferenceHandler))}}class m{constructor(e){this.core=e,this.players=new Map,this.events=[],this.viewCountTracked=new Set}init(){this.initializeAllPlayers(),this.setupGlobalEventListeners(),this.core.registerComponent("videoPlayer",this)}initializeAllPlayers(){document.querySelectorAll(".video-player-container").forEach((e=>{this.initializePlayer(e)}))}initializePlayer(e){const t=e.dataset.videoId,s=e.dataset.videoType||"mp4";if(!t)return;const i={id:t,type:s,container:e,element:null,isInitialized:!1,events:[]};"mp4"===s||"self-hosted"===s?this.initSelfHostedPlayer(i):this.initEmbeddedPlayer(i),this.trackViewCount(i),this.players.set(t,i)}initSelfHostedPlayer(e){const t=e.container.querySelector("video.main-video-player");t&&(e.element=t,t.removeAttribute("controls"),t.controls=!1,this.setupCustomControls(e),this.setupVideoEventListeners(e),this.attemptAutoplay(e),e.isInitialized=!0,this.core.emit("video-player:initialized",{player:e,type:"self-hosted"}))}initEmbeddedPlayer(e){const t=e.container.querySelector(".embed-responsive");t&&(this.createEmbedIframe(e,t),this.setupIframeResponsive(e),e.isInitialized=!0,this.core.emit("video-player:initialized",{player:e,type:"embedded"}))}createEmbedIframe(e,t){const s=e.container.dataset.videoUrl||"";let i="",o=e.id;switch(!o&&s&&(o=this.extractVideoId(s,e.type)),e.type){case"youtube":i=`https://www.youtube.com/embed/${o}?rel=0&showinfo=0&modestbranding=1`;break;case"vimeo":i=`https://player.vimeo.com/video/${o}?api=1&title=0&byline=0&portrait=0&dnt=1`;break;case"pornhub":i=`https://www.pornhub.com/embed/${o}`;break;case"xvideos":i=`https://www.xvideos.com/embedframe/${o}`;break;case"xhamster":i=this.createXHamsterEmbedUrl(o,s);break;case"redtube":i=`https://embed.redtube.com/?id=${o}`;break;case"youporn":i=`https://www.youporn.com/embed/${o}/`;break;default:return void this.showVideoError(t,`Unsupported video type: ${e.type}`)}const a=document.createElement("iframe");a.className="embed-iframe",a.src=i,a.frameBorder="0",a.allowFullscreen=!0,a.loading="lazy",a.allow="autoplay; fullscreen",a.scrolling="no",a.sandbox="allow-same-origin allow-scripts allow-popups allow-forms",a.style.width="100%",a.style.height="100%",t.innerHTML="",t.appendChild(a),e.element=a,"youtube"===e.type?this.setupYouTubePlayer(e,a):"vimeo"===e.type&&this.setupVimeoPlayer(e,a)}createXHamsterEmbedUrl(e,t){if(!e&&t&&t.includes("xhamster.com")){if(t.includes("/videos/")){const e=t.split("/videos/")[1].split("/")[0];if(e)return`https://xhamster.com/embed/${e}`}return t.replace("/videos/","/embed/")}return`https://xhamster.com/embed/${e}`}extractVideoId(e,t){const s={youtube:[/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\n?#]+)/,/youtube\.com\/embed\/([^&\n?#]+)/],vimeo:[/vimeo\.com\/(\d+)/,/player\.vimeo\.com\/video\/(\d+)/],xhamster:[/xhamster\.com\/videos\/([^\/&?"']+)/,/xhamster\.com\/embed\/([^\/&?"']+)/]}[t]||[];for(const t of s){const s=e.match(t);if(s&&s[1])return s[1]}return""}setupCustomControls(e){const t=e.container,s=(e.element,t.querySelector(".custom-controls"));if(!s)return;const i={playPause:s.querySelector(".play-pause"),volumeButton:s.querySelector(".volume-button"),volumeSlider:s.querySelector(".volume-slider"),progressBar:s.querySelector(".progress-bar"),progressContainer:s.querySelector(".video-progress"),currentTime:s.querySelector(".current-time"),duration:s.querySelector(".duration"),fullscreen:s.querySelector(".fullscreen-button"),quality:s.querySelector(".quality-selector")};e.controls=i,this.setupControlEventListeners(e),this.setupControlsAutoHide(e)}setupControlEventListeners(e){const t=e.element,s=e.controls,i=e.container;s.playPause&&e.events.push(l(s.playPause,"click",(()=>{t.paused||t.ended?this.playVideo(e):this.pauseVideo(e)}))),s.volumeButton&&e.events.push(l(s.volumeButton,"click",(()=>{this.toggleMute(e)}))),s.volumeSlider&&e.events.push(l(s.volumeSlider,"input",(s=>{const i=parseFloat(s.target.value);t.volume=i,t.muted=0===i,this.updateVolumeState(e)}))),s.progressContainer&&e.events.push(l(s.progressContainer,"click",(e=>{if(!isNaN(t.duration)){const i=s.progressContainer.getBoundingClientRect(),o=(e.clientX-i.left)/i.width*t.duration;t.currentTime=o}}))),s.fullscreen&&e.events.push(l(s.fullscreen,"click",(()=>{this.toggleFullscreen(e)}))),s.quality&&this.setupQualitySelector(e),e.events.push(l(t,"click",(()=>{t.paused||t.ended?this.playVideo(e):this.pauseVideo(e)}))),e.events.push(l(document,"keydown",(t=>{i.classList.contains("is-active")&&this.handleKeyboardShortcuts(e,t)})))}setupVideoEventListeners(e){const t=e.element,s=e.container;e.events.push(l(t,"play",(()=>{s.classList.add("is-playing"),this.core.emit("video-player:play",{player:e})})),l(t,"pause",(()=>{s.classList.remove("is-playing"),this.core.emit("video-player:pause",{player:e})})),l(t,"ended",(()=>{s.classList.remove("is-playing"),this.core.emit("video-player:ended",{player:e})})),l(t,"timeupdate",(()=>{this.updateProgress(e)})),l(t,"loadedmetadata",(()=>{this.updateDuration(e)})),l(t,"volumechange",(()=>{this.updateVolumeState(e)}))),e.events.push(l(s,"mouseenter",(()=>{document.querySelectorAll(".video-player-container").forEach((e=>{e.classList.remove("is-active")})),s.classList.add("is-active")})))}attemptAutoplay(e){const t=e.element;t.muted=!0;const s=t.play();void 0!==s&&s.then((()=>{e.container.addEventListener("click",(()=>{t.muted=!1}),{once:!0})})).catch((t=>{this.showPlayButton(e)}))}showPlayButton(e){const t=e.container,s=document.createElement("div");s.className="play-button-overlay",s.innerHTML='\n            <div class="play-button">\n                <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="white">\n                    <path d="M8 5v14l11-7z"/>\n                </svg>\n            </div>\n        ',t.appendChild(s),s.addEventListener("click",(()=>{this.playVideo(e).then((()=>{e.element.muted=!1,s.remove()})).catch((e=>{}))}))}async playVideo(e){try{return await e.element.play(),!0}catch(e){return!1}}pauseVideo(e){e.element.pause()}toggleMute(e){const t=e.element;t.muted?(t.muted=!1,e.controls.volumeSlider&&(e.controls.volumeSlider.value=t.volume)):(t.muted=!0,e.controls.volumeSlider&&(e.controls.volumeSlider.value=0)),this.updateVolumeState(e)}toggleFullscreen(e){const t=e.element;t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()}updateProgress(e){const t=e.element,s=e.controls;if(!s||isNaN(t.duration))return;const i=t.currentTime,o=i/t.duration*100;s.progressBar&&(s.progressBar.style.width=o+"%"),s.currentTime&&(s.currentTime.textContent=r(i))}updateDuration(e){const t=e.element,s=e.controls;s&&s.duration&&!isNaN(t.duration)&&(s.duration.textContent=r(t.duration))}updateVolumeState(e){const t=e.element,s=e.controls;s&&s.volumeButton&&(t.muted||0===t.volume?s.volumeButton.classList.add("is-muted"):s.volumeButton.classList.remove("is-muted"))}handleKeyboardShortcuts(e,t){const s=e.element;switch(t.code){case"Space":s.paused||s.ended?this.playVideo(e):this.pauseVideo(e),t.preventDefault();break;case"ArrowLeft":s.currentTime=Math.max(0,s.currentTime-5),t.preventDefault();break;case"ArrowRight":s.currentTime=Math.min(s.duration,s.currentTime+5),t.preventDefault();break;case"ArrowUp":s.volume=Math.min(1,s.volume+.1),e.controls.volumeSlider&&(e.controls.volumeSlider.value=s.volume),this.updateVolumeState(e),t.preventDefault();break;case"ArrowDown":s.volume=Math.max(0,s.volume-.1),e.controls.volumeSlider&&(e.controls.volumeSlider.value=s.volume),this.updateVolumeState(e),t.preventDefault();break;case"KeyM":this.toggleMute(e),t.preventDefault();break;case"KeyF":this.toggleFullscreen(e),t.preventDefault()}}setupQualitySelector(e){const t=e.controls,s=t.quality.querySelector(".quality-button"),i=t.quality.querySelector(".quality-options");if(!s||!i)return;e.events.push(l(s,"click",(()=>{i.classList.toggle("is-visible")})));i.querySelectorAll("button").forEach((t=>{e.events.push(l(t,"click",(()=>{const s=t.dataset.quality,o=t.dataset.url;this.changeQuality(e,s,o),i.classList.remove("is-visible")})))})),e.events.push(l(document,"click",(e=>{t.quality.contains(e.target)||i.classList.remove("is-visible")})))}changeQuality(e,t,s){const i=e.element,o=i.currentTime,a=i.paused;i.src=s,i.currentTime=o,a||this.playVideo(e);const n=e.controls.quality.querySelector(".quality-button");n&&(n.textContent=t),this.core.emit("video-player:quality-changed",{player:e,quality:t})}setupControlsAutoHide(e){const t=e.container,s=t.querySelector(".custom-controls");if(!s)return;let i;const o=()=>{s.classList.add("is-visible"),clearTimeout(i),i=setTimeout((()=>{e.element.paused||s.classList.remove("is-visible")}),3e3)};e.events.push(l(t,"mousemove",o),l(t,"mouseenter",o),l(t,"mouseleave",(()=>{s.classList.remove("is-visible"),clearTimeout(i)}))),e.events.push(l(e.element,"pause",(()=>{s.classList.add("is-visible"),clearTimeout(i)})))}setupYouTubePlayer(e,t){const s=t.src;if(-1===s.indexOf("enablejsapi=1")){const e=-1!==s.indexOf("?")?"&":"?";t.src=s+e+"enablejsapi=1"}t.classList.add("youtube-api-ready")}setupVimeoPlayer(e,t){t.classList.add("vimeo-api-ready")}setupIframeResponsive(e){const t=e.element,s=e.container;t.style.width="100%",t.style.height="100%",t.style.border="0",e.events.push(l(s,"mouseenter",(()=>{document.querySelectorAll(".video-player-container").forEach((e=>{e.classList.remove("is-active")})),s.classList.add("is-active")})))}showVideoError(e,t){e.innerHTML=`\n            <div class="video-error">\n                <p><strong>Video Error:</strong> ${t}</p>\n                <p>Please check the video URL and try again.</p>\n            </div>\n        `}trackViewCount(e){const t=e.id;this.viewCountTracked.has(t)||(this.viewCountTracked.add(t),setTimeout((()=>{this.core.ajax.updateViewCount(t).catch((e=>{}))}),1e3))}setupGlobalEventListeners(){this.events.push(l(window,"load",(()=>{setTimeout((()=>{this.initializeAllPlayers()}),500)}))),this.core.on("content:loaded",(()=>{this.initializeAllPlayers()}))}getPlayer(e){return this.players.get(e)||null}getAllPlayers(){return this.players}removePlayer(e){const t=this.players.get(e);t&&(t.events.forEach((e=>e())),this.viewCountTracked.delete(e),this.players.delete(e),this.core.emit("video-player:removed",{videoId:e}))}cleanup(){this.players.forEach(((e,t)=>{this.removePlayer(t)})),this.events.forEach((e=>e())),this.events=[],this.viewCountTracked.clear()}}class p{constructor(e){this.core=e,this.elements={},this.state={currentPage:1,isLoading:!1,hasMore:!0,activeFilters:{},lazyLoadObserver:null,masonryInstance:null},this.events=[]}init(){this.cacheElements(),this.initializeLayouts(),this.setupFiltering(),this.setupLazyLoading(),this.setupLoadMore(),this.setupEventListeners(),this.core.registerComponent("videoGrid",this)}cacheElements(){this.elements={grids:document.querySelectorAll(".video-grid, .video-masonry"),filterForm:document.querySelector(".filter-form"),filterInputs:document.querySelectorAll(".filter-input"),sortSelects:document.querySelectorAll(".sort-select"),categoryFilters:document.querySelectorAll(".category-filter a"),tagFilters:document.querySelectorAll(".tag-filter a"),performerFilters:document.querySelectorAll(".performer-filter a"),durationSliders:document.querySelectorAll('input[type="range"]'),loadMoreButtons:document.querySelectorAll(".load-more-button, .view-more-button"),lazyImages:document.querySelectorAll("img[data-src]"),videoItems:document.querySelectorAll(".video-grid-item, .video-card, .videoBox"),gridContainers:document.querySelectorAll(".video-grid-container")}}initializeLayouts(){this.elements.grids.forEach((e=>{e.classList.contains("video-masonry")?this.initializeMasonry(e):this.initializeFlexGrid(e)}))}initializeMasonry(e){if(void 0!==window.Masonry){const t=new window.Masonry(e,{itemSelector:".video-grid-item, .video-card",columnWidth:".video-grid-item, .video-card",percentPosition:!0,gutter:10});this.state.masonryInstance=t,this.setupMasonryImageLoad(e,t)}else this.initializeFlexGrid(e)}setupMasonryImageLoad(e,t){const s=e.querySelectorAll("img");let i=0;const o=()=>{i++,i===s.length&&t.layout()};s.forEach((e=>{e.complete?o():this.events.push(l(e,"load",o),l(e,"error",o))}))}initializeFlexGrid(e){e.style.display="flex",e.style.flexWrap="wrap",e.style.gap="1rem",this.setupResponsiveColumns(e)}setupResponsiveColumns(e){const t=()=>{const t=e.querySelectorAll(".video-grid-item, .video-card"),s=e.offsetWidth;let i;i=s<768?2:s<1024?3:s<1440?4:5;const o=`calc(${100/i}% - 1rem)`;t.forEach((e=>{e.style.width=o}))};t(),this.events.push(l(window,"resize",i(t,250)))}setupFiltering(){this.elements.categoryFilters.forEach((e=>{this.events.push(l(e,"click",(t=>{t.preventDefault();const s=e.dataset.category||e.textContent.trim();this.applyFilter("category",s)})))})),this.elements.tagFilters.forEach((e=>{this.events.push(l(e,"click",(t=>{t.preventDefault();const s=e.dataset.tag||e.textContent.trim();this.applyFilter("tag",s)})))})),this.elements.performerFilters.forEach((e=>{this.events.push(l(e,"click",(t=>{t.preventDefault();const s=e.dataset.performer||e.textContent.trim();this.applyFilter("performer",s)})))})),this.elements.sortSelects.forEach((e=>{this.events.push(l(e,"change",(e=>{const t=e.target.value;this.applyFilter("sort",t)})))})),this.elements.durationSliders.forEach((e=>{this.events.push(l(e,"input",i((e=>{const t=e.target.value;this.applyFilter("duration",t)}),300)))})),this.elements.filterForm&&this.events.push(l(this.elements.filterForm,"submit",(e=>{e.preventDefault(),this.applyFiltersFromForm()})))}applyFilter(e,t){this.state.activeFilters[e]=t,this.addFilteringClasses(),this.state.currentPage=1,this.state.hasMore=!0,this.executeFiltering(),this.core.emit("video-grid:filter-applied",{filterType:e,filterValue:t,activeFilters:{...this.state.activeFilters}})}applyFiltersFromForm(){const e=new FormData(this.elements.filterForm),t={};for(const[s,i]of e.entries())i&&(t[s]=i);this.state.activeFilters=t,this.addFilteringClasses(),this.executeFiltering(),this.core.emit("video-grid:filters-applied",{activeFilters:{...this.state.activeFilters}})}addFilteringClasses(){this.elements.gridContainers.forEach((e=>{e.classList.add("filtered-results")})),this.elements.grids.forEach((e=>{e.classList.add("filtered")})),this.elements.videoItems.forEach((e=>{e.style.float="none"}))}async executeFiltering(){if(!this.state.isLoading){this.state.isLoading=!0,this.showLoadingState();try{const e=await this.core.ajax.getFilteredVideos({...this.state.activeFilters,page:this.state.currentPage});e.success?(this.updateGridContent(e.data.videos),this.state.hasMore=e.data.has_more,this.updateLoadMoreButton()):this.showError("Failed to load filtered videos")}catch(e){this.showError("Error loading videos")}finally{this.state.isLoading=!1,this.hideLoadingState()}}}updateGridContent(e){this.elements.grids.forEach((t=>{1===this.state.currentPage&&(t.innerHTML=""),e.forEach((e=>{const s=this.createVideoElement(e);t.appendChild(s)})),this.setupLazyLoadingForElement(t),this.state.masonryInstance&&(this.state.masonryInstance.reloadItems(),this.state.masonryInstance.layout())})),this.elements.videoItems=document.querySelectorAll(".video-grid-item, .video-card, .videoBox"),this.core.emit("video-grid:content-updated",{videos:e})}createVideoElement(e){const t=document.createElement("div");return t.className="video-grid-item video-card",t.setAttribute("data-video-id",e.id),t.innerHTML=`\n            <div class="video-thumbnail-container">\n                <img data-src="${e.thumbnail}" alt="${e.title}" class="lazy-load">\n                <div class="video-duration">${e.duration}</div>\n                ${e.liked?'<div class="video-liked-indicator">♥</div>':""}\n            </div>\n            <div class="video-info">\n                <h3 class="video-title">\n                    <a href="${e.url}">${e.title}</a>\n                </h3>\n                <div class="video-meta">\n                    <span class="video-views">${e.views} views</span>\n                    <span class="video-date">${e.date}</span>\n                </div>\n            </div>\n        `,t}setupLazyLoading(){"IntersectionObserver"in window?this.setupIntersectionObserver():this.setupScrollBasedLazyLoading()}setupIntersectionObserver(){this.state.lazyLoadObserver=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&(this.loadImage(e.target),this.state.lazyLoadObserver.unobserve(e.target))}))}),{root:null,rootMargin:"50px",threshold:.1}),this.elements.lazyImages.forEach((e=>{this.state.lazyLoadObserver.observe(e)}))}setupLazyLoadingForElement(e){const t=e.querySelectorAll("img[data-src]");this.state.lazyLoadObserver?t.forEach((e=>{this.state.lazyLoadObserver.observe(e)})):t.forEach((e=>{c(e)&&this.loadImage(e)}))}loadImage(e){if(e.dataset.src&&!e.dataset.loaded){const t=new Image;t.onload=()=>{e.src=e.dataset.src,e.classList.add("loaded"),e.dataset.loaded="true",delete e.dataset.src,this.core.emit("video-grid:image-loaded",{img:e})},t.onerror=()=>{e.classList.add("error")},t.src=e.dataset.src}}setupScrollBasedLazyLoading(){const e=o((()=>{this.elements.lazyImages.forEach((e=>{c(e)&&this.loadImage(e)}))}),100);this.events.push(l(window,"scroll",e,{passive:!0}),l(window,"resize",e,{passive:!0})),e()}setupLoadMore(){this.elements.loadMoreButtons.forEach((e=>{this.events.push(l(e,"click",(e=>{e.preventDefault(),this.loadMoreVideos()})))})),this.shouldUseInfiniteScroll()&&this.setupInfiniteScroll()}shouldUseInfiniteScroll(){return"true"===document.body.dataset.infiniteScroll||document.querySelector(".infinite-scroll-enabled")}setupInfiniteScroll(){const e=o((()=>{window.innerHeight+window.pageYOffset>=document.documentElement.offsetHeight-200&&this.state.hasMore&&!this.state.isLoading&&this.loadMoreVideos()}),250);this.events.push(l(window,"scroll",e,{passive:!0}))}async loadMoreVideos(){if(!this.state.isLoading&&this.state.hasMore){this.state.isLoading=!0,this.state.currentPage++,this.showLoadingState();try{const e=await this.core.ajax.loadMoreVideos(this.state.currentPage,this.state.activeFilters);e.success?(this.appendVideos(e.data.videos),this.state.hasMore=e.data.has_more,this.updateLoadMoreButton()):(this.showError("Failed to load more videos"),this.state.currentPage--)}catch(e){this.showError("Error loading more videos"),this.state.currentPage--}finally{this.state.isLoading=!1,this.hideLoadingState()}}}appendVideos(e){this.elements.grids.forEach((t=>{e.forEach((e=>{const s=this.createVideoElement(e);t.appendChild(s)})),this.setupLazyLoadingForElement(t),this.state.masonryInstance&&(this.state.masonryInstance.appended(t.querySelectorAll(".video-grid-item:not(.masonry-processed)")),t.querySelectorAll(".video-grid-item").forEach((e=>{e.classList.add("masonry-processed")})))})),this.core.emit("video-grid:videos-appended",{videos:e,currentPage:this.state.currentPage})}updateLoadMoreButton(){this.elements.loadMoreButtons.forEach((e=>{this.state.hasMore?(e.style.display="block",e.disabled=!1,e.textContent="Load More Videos"):e.style.display="none"}))}showLoadingState(){this.elements.loadMoreButtons.forEach((e=>{e.disabled=!0,e.textContent="Loading..."})),this.elements.grids.forEach((e=>{e.classList.add("loading")}))}hideLoadingState(){this.elements.grids.forEach((e=>{e.classList.remove("loading")}))}showError(e){let t=document.querySelector(".video-grid-error");t||(t=document.createElement("div"),t.className="video-grid-error",this.elements.grids.length>0&&this.elements.grids[0].parentNode.insertBefore(t,this.elements.grids[0])),t.innerHTML=`\n            <div class="error-message">\n                <p>${e}</p>\n                <button class="retry-button">Retry</button>\n            </div>\n        `;const s=t.querySelector(".retry-button");s&&this.events.push(l(s,"click",(()=>{t.remove(),Object.keys(this.state.activeFilters).length>0?this.executeFiltering():this.loadMoreVideos()}))),setTimeout((()=>{t&&t.parentNode&&t.remove()}),5e3)}setupEventListeners(){this.core.on("breakpoint:changed",(e=>{this.handleBreakpointChange(e.detail)})),this.core.on("content:loaded",(()=>{this.reinitialize()}))}handleBreakpointChange(e){this.state.masonryInstance&&setTimeout((()=>{this.state.masonryInstance.layout()}),100),this.elements.grids.forEach((e=>{e.classList.contains("video-masonry")||this.setupResponsiveColumns(e)}))}clearFilters(){this.state.activeFilters={},this.state.currentPage=1,this.state.hasMore=!0,this.elements.gridContainers.forEach((e=>{e.classList.remove("filtered-results")})),this.elements.grids.forEach((e=>{e.classList.remove("filtered")})),this.elements.filterForm&&this.elements.filterForm.reset(),this.executeFiltering(),this.core.emit("video-grid:filters-cleared")}getState(){return{currentPage:this.state.currentPage,isLoading:this.state.isLoading,hasMore:this.state.hasMore,activeFilters:{...this.state.activeFilters},gridCount:this.elements.grids.length,videoCount:this.elements.videoItems.length}}reinitialize(){this.cacheElements(),this.setupLazyLoading(),this.initializeLayouts()}cleanup(){this.events.forEach((e=>e())),this.events=[],this.state.lazyLoadObserver&&(this.state.lazyLoadObserver.disconnect(),this.state.lazyLoadObserver=null),this.state.masonryInstance&&(this.state.masonryInstance.destroy(),this.state.masonryInstance=null),this.state={currentPage:1,isLoading:!1,hasMore:!0,activeFilters:{},lazyLoadObserver:null,masonryInstance:null}}}class v{constructor(e){this.core=e,this.elements={},this.state={hoverDelay:300,previewTimeout:null,activePreview:null,isPreviewPlaying:!1,keyboardNavigationEnabled:!0,watchedVideos:this.loadWatchedVideos()},this.events=[]}init(){this.cacheElements(),this.setupHoverPreviews(),this.setupSmoothScrolling(),this.setupKeyboardNavigation(),this.setupAccessibilityFeatures(),this.setupPerformanceOptimizations(),this.setupVideoClickTracking(),this.core.registerComponent("enhancedFeatures",this)}cacheElements(){this.elements={videoThumbnails:document.querySelectorAll(".video-thumbnail-container"),videoCards:document.querySelectorAll(".video-card, .videoBox"),smoothScrollTriggers:document.querySelectorAll('a[href^="#"]'),performerLetterLinks:document.querySelectorAll('a[href^="#letter-"]'),focusableElements:document.querySelectorAll('a, button, input, [tabindex]:not([tabindex="-1"])'),keyboardNavigableCards:document.querySelectorAll(".video-card[tabindex], .videoBox[tabindex]")}}setupHoverPreviews(){this.elements.videoThumbnails.forEach((e=>{this.setupSingleHoverPreview(e)}))}setupSingleHoverPreview(e){this.events.push(l(e,"mouseenter",(()=>{this.state.previewTimeout&&clearTimeout(this.state.previewTimeout),this.state.previewTimeout=setTimeout((()=>{this.startPreview(e)}),this.state.hoverDelay)})),l(e,"mouseleave",(()=>{this.state.previewTimeout&&(clearTimeout(this.state.previewTimeout),this.state.previewTimeout=null),this.stopPreview()})))}startPreview(e){this.stopPreview();const t=e.dataset.previewSrc,s=e.dataset.webpPreviewSrc;t?this.startVideoPreview(e,t):s&&this.startWebPPreview(e,s)}startVideoPreview(e,t){let s=e.querySelector("video.thumbnail-preview");s||(s=document.createElement("video"),s.className="thumbnail-preview",s.muted=!0,s.loop=!0,s.playsInline=!0,s.style.cssText="\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                object-fit: cover;\n                z-index: 2;\n                transition: opacity 0.3s ease;\n            ",e.appendChild(s)),s.src=t,s.load();const i=s.play();void 0!==i&&i.then((()=>{this.state.isPreviewPlaying=!0,this.state.activePreview=s,e.classList.add("preview-active"),this.core.emit("enhanced-features:preview-started",{container:e,type:"video"})})).catch((t=>{this.fallbackToStaticPreview(e)}))}startWebPPreview(e,t){const s=e.querySelector("img.thumbnail-static, img:not(.thumbnail-webp)");s&&(s.style.opacity="0");let i=e.querySelector("img.thumbnail-webp");i||(i=document.createElement("img"),i.className="thumbnail-webp",i.alt="Animated Preview",i.style.cssText="\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                object-fit: cover;\n                z-index: 2;\n                opacity: 0;\n                transition: opacity 0.3s ease;\n            ",e.appendChild(i)),i.src=t,i.style.opacity="1",this.state.activePreview=i,e.classList.add("preview-active"),this.core.emit("enhanced-features:preview-started",{container:e,type:"webp"})}fallbackToStaticPreview(e){e.style.transform="scale(1.02)",e.style.transition="transform 0.3s ease",this.state.activePreview=e,e.classList.add("preview-active")}stopPreview(){if(this.state.activePreview){const e=this.state.activePreview.closest(".video-thumbnail-container")||this.state.activePreview;if("VIDEO"===this.state.activePreview.tagName)this.state.activePreview.pause(),this.state.activePreview.currentTime=0,this.state.isPreviewPlaying=!1;else if(this.state.activePreview.classList&&this.state.activePreview.classList.contains("thumbnail-webp")){this.state.activePreview.style.opacity="0";const t=e.querySelector("img.thumbnail-static, img:not(.thumbnail-webp)");t&&(t.style.opacity="1")}else e.style.transform="";e.classList.remove("preview-active"),this.state.activePreview=null,this.core.emit("enhanced-features:preview-stopped",{container:e})}}setupSmoothScrolling(){this.elements.smoothScrollTriggers.forEach((e=>{this.events.push(l(e,"click",(t=>{const s=e.getAttribute("href");if(s&&s.startsWith("#")){const e=document.querySelector(s);e&&(t.preventDefault(),this.smoothScrollTo(e))}}),{passive:!0}))})),this.elements.performerLetterLinks.forEach((e=>{this.events.push(l(e,"click",(t=>{t.preventDefault();const s=e.getAttribute("href"),i=document.querySelector(s);i&&this.smoothScrollTo(i,50)}),{passive:!0}))}))}smoothScrollTo(e,t=20){const s=e.getBoundingClientRect().top+window.pageYOffset-t;"scrollBehavior"in document.documentElement.style?window.scrollTo({top:s,behavior:"smooth"}):this.fallbackSmoothScroll(s),this.core.emit("enhanced-features:smooth-scroll",{target:e,offset:t})}fallbackSmoothScroll(e){const t=window.pageYOffset,s=e-t,i=Math.min(Math.abs(s)/2,500);let o=null;const a=e=>{null===o&&(o=e);const n=e-o,r=Math.min(n/i,1),l=1-Math.pow(1-r,3);window.scrollTo(0,t+s*l),n<i&&requestAnimationFrame(a)};requestAnimationFrame(a)}setupKeyboardNavigation(){this.state.keyboardNavigationEnabled&&(this.elements.videoCards.forEach((e=>{e.hasAttribute("tabindex")||e.setAttribute("tabindex","0")})),this.elements.keyboardNavigableCards.forEach((e=>{this.events.push(l(e,"keydown",(t=>{this.handleCardKeydown(t,e)})))})),this.events.push(l(document,"keydown",(e=>{this.handleGlobalKeydown(e)}))))}handleCardKeydown(e,t){switch(e.key){case"Enter":case" ":e.preventDefault(),this.activateCard(t);break;case"ArrowRight":case"ArrowDown":e.preventDefault(),this.focusNextCard(t);break;case"ArrowLeft":case"ArrowUp":e.preventDefault(),this.focusPreviousCard(t);break;case"Home":e.preventDefault(),this.focusFirstCard();break;case"End":e.preventDefault(),this.focusLastCard()}}handleGlobalKeydown(e){if(e.altKey&&"h"===e.key&&(e.preventDefault(),this.focusFirstCard()),"Escape"===e.key){const e=document.activeElement;e&&(e.classList.contains("video-card")||e.classList.contains("videoBox"))&&e.blur()}}activateCard(e){const t=e.querySelector('a[href]:not([href^="#"])');if(t){const s=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window});t.dispatchEvent(s),this.core.emit("enhanced-features:card-activated",{card:e,link:t})}}focusNextCard(e){const t=Array.from(this.elements.keyboardNavigableCards),s=(t.indexOf(e)+1)%t.length;t[s].focus(),this.scrollCardIntoView(t[s])}focusPreviousCard(e){const t=Array.from(this.elements.keyboardNavigableCards),s=t.indexOf(e),i=0===s?t.length-1:s-1;t[i].focus(),this.scrollCardIntoView(t[i])}focusFirstCard(){this.elements.keyboardNavigableCards.length>0&&(this.elements.keyboardNavigableCards[0].focus(),this.scrollCardIntoView(this.elements.keyboardNavigableCards[0]))}focusLastCard(){const e=this.elements.keyboardNavigableCards;e.length>0&&(e[e.length-1].focus(),this.scrollCardIntoView(e[e.length-1]))}scrollCardIntoView(e){c(e)||e.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}setupAccessibilityFeatures(){this.elements.videoCards.forEach(((e,t)=>{if(!e.hasAttribute("aria-label")){const s=e.querySelector(".video-title, h3, h2"),i=s?s.textContent.trim():`Video ${t+1}`;e.setAttribute("aria-label",`Play video: ${i}`)}e.hasAttribute("role")||e.setAttribute("role","button")})),this.addFocusIndicators(),this.setupReducedMotion()}addFocusIndicators(){const e=document.createElement("style");e.textContent="\n            .video-card:focus,\n            .videoBox:focus,\n            .video-thumbnail-container:focus {\n                outline: 2px solid #007cba;\n                outline-offset: 2px;\n                box-shadow: 0 0 0 4px rgba(0, 124, 186, 0.3);\n            }\n            \n            .video-card:focus .video-thumbnail-container,\n            .videoBox:focus .video-thumbnail-container {\n                transform: scale(1.02);\n                transition: transform 0.2s ease;\n            }\n        ",document.head.appendChild(e)}setupReducedMotion(){const e=window.matchMedia("(prefers-reduced-motion: reduce)");(e=>{e.matches?(this.state.hoverDelay=0,document.body.classList.add("reduced-motion"),this.elements.videoThumbnails.forEach((e=>{e.style.pointerEvents="auto",e.dataset.previewDisabled="true"}))):(document.body.classList.remove("reduced-motion"),this.elements.videoThumbnails.forEach((e=>{delete e.dataset.previewDisabled})))})(e),e.addEventListener?e.addEventListener("change",handleSystemPreferenceChange):e.addListener(handleSystemPreferenceChange)}setupPerformanceOptimizations(){const e=i((()=>{this.elements.videoThumbnails.forEach((e=>{e.dataset.previewDisabled||c(e)||!this.state.activePreview||this.state.activePreview!==e&&this.state.activePreview.closest(".video-thumbnail-container")!==e||this.stopPreview()}))}),100);this.events.push(l(window,"scroll",e,{passive:!0})),this.events.push(l(document,"visibilitychange",(()=>{document.hidden&&this.stopPreview()})))}setupVideoClickTracking(){this.elements.videoCards.forEach((e=>{const t=e.querySelector("a[href]");t&&this.events.push(l(t,"click",(t=>{const s=e.dataset.videoId;s&&(this.addWatchedVideo(s),this.core.ajax.trackUserBehavior(s,"click").catch(console.error))}),{passive:!0}))}))}loadWatchedVideos(){try{const e=localStorage.getItem("watchedVideos");return e?JSON.parse(e):[]}catch(e){return[]}}addWatchedVideo(e){const t=parseInt(e);if(!isNaN(t)){this.state.watchedVideos=[t,...this.state.watchedVideos.filter((e=>e!==t))],this.state.watchedVideos.length>50&&(this.state.watchedVideos=this.state.watchedVideos.slice(0,50));try{localStorage.setItem("watchedVideos",JSON.stringify(this.state.watchedVideos))}catch(e){}}}getWatchedVideos(){return this.state.watchedVideos}setHoverDelay(e){this.state.hoverDelay=Math.max(0,e),this.core.emit("enhanced-features:hover-delay-changed",{delay:this.state.hoverDelay})}setKeyboardNavigation(e){this.state.keyboardNavigationEnabled=e,e?this.setupKeyboardNavigation():this.elements.videoCards.forEach((e=>{"0"===e.getAttribute("tabindex")&&e.removeAttribute("tabindex")})),this.core.emit("enhanced-features:keyboard-navigation-changed",{enabled:e})}getState(){return{hoverDelay:this.state.hoverDelay,isPreviewPlaying:this.state.isPreviewPlaying,keyboardNavigationEnabled:this.state.keyboardNavigationEnabled,activePreview:!!this.state.activePreview,thumbnailCount:this.elements.videoThumbnails.length,cardCount:this.elements.videoCards.length,watchedVideosCount:this.state.watchedVideos.length}}reinitialize(){this.stopPreview(),this.cacheElements(),this.setupHoverPreviews(),this.state.keyboardNavigationEnabled&&this.setupKeyboardNavigation(),this.setupAccessibilityFeatures(),this.setupVideoClickTracking()}cleanup(){this.stopPreview(),this.state.previewTimeout&&(clearTimeout(this.state.previewTimeout),this.state.previewTimeout=null),this.events.forEach((e=>e())),this.events=[],this.state={hoverDelay:300,previewTimeout:null,activePreview:null,isPreviewPlaying:!1,keyboardNavigationEnabled:!0,watchedVideos:[]}}}class y{constructor(e){this.core=e,this.elements={},this.state={adsLoaded:!1,headerAdSynced:!1,vastClient:null,adEvents:new Map,activeVideoAds:new Map},this.events=[]}init(){this.cacheElements(),this.setupBannerAds(),this.setupVideoAds(),this.setupHeaderAdSync(),this.setupAdEventTracking(),this.loadAdLibraries(),this.core.registerComponent("adsManager",this)}cacheElements(){this.elements={adContainers:document.querySelectorAll(".ad-container"),bannerAds:document.querySelectorAll(".banner-ad, .ad-banner"),headerAds:document.querySelectorAll(".header-ad, .ph-nav-ad"),sidebarAds:document.querySelectorAll(".sidebar-ad"),footerAds:document.querySelectorAll(".footer-ad"),videoAdContainers:document.querySelectorAll(".video-ad-container"),prerollContainers:document.querySelectorAll(".preroll-ad"),midrollContainers:document.querySelectorAll(".midroll-ad"),postrollContainers:document.querySelectorAll(".postroll-ad"),stickyAds:document.querySelectorAll(".sticky-ad"),mobileAds:document.querySelectorAll(".mobile-ad")}}setupBannerAds(){this.elements.adContainers.forEach((e=>{this.initializeAdContainer(e)})),this.setupResponsiveAds()}initializeAdContainer(e){const t=e.dataset.adCode,s=e.dataset.adType||"banner",i=e.dataset.adSize||"728x90",o=e.dataset.adNetwork||"generic";t?this.loadAdContent(e,t,s,o):this.loadPlaceholderAd(e,i),this.setupAdVisibilityTracking(e)}loadAdContent(e,t,s,i){try{switch(i.toLowerCase()){case"adsense":this.loadAdSenseAd(e,t);break;case"dfp":case"gam":this.loadGoogleAdManagerAd(e,t);break;case"prebid":this.loadPrebidAd(e,t);break;default:this.loadGenericAd(e,t)}this.core.emit("ads:ad-loaded",{container:e,adType:s,adNetwork:i})}catch(t){this.loadPlaceholderAd(e)}}loadAdSenseAd(e,t){const s=document.createElement("div");s.innerHTML=t,e.appendChild(s),window.adsbygoogle?(adsbygoogle=window.adsbygoogle||[]).push({}):this.loadScript("https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js",(()=>{(adsbygoogle=window.adsbygoogle||[]).push({})}))}loadGoogleAdManagerAd(e,t){const s=`ad-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;e.id=s,window.googletag?this.defineGAMSlot(s,t,e):this.loadScript("https://securepubads.g.doubleclick.net/tag/js/gpt.js",(()=>{window.googletag=window.googletag||{cmd:[]},this.defineGAMSlot(s,t,e)}))}defineGAMSlot(e,t,s){googletag.cmd.push((()=>{const i=s.dataset.adSize?s.dataset.adSize.split("x").map(Number):[728,90],o=googletag.defineSlot(t,i,e).addService(googletag.pubads());googletag.pubads().enableSingleRequest(),googletag.enableServices(),googletag.display(e),s.dataset.adSlot=o.getSlotElementId()}))}loadPrebidAd(e,t){this.loadGenericAd(e,t)}loadGenericAd(e,t){const s=document.createElement("div");s.innerHTML=t,e.appendChild(s);s.querySelectorAll("script").forEach((e=>{const t=document.createElement("script");e.src?t.src=e.src:t.textContent=e.textContent,document.head.appendChild(t)}))}loadPlaceholderAd(e,t="728x90"){const[s,i]=t.split("x").map(Number),o=document.createElement("div");o.className="ad-placeholder",o.style.cssText=`\n            width: ${s}px;\n            height: ${i}px;\n            background: #f0f0f0;\n            border: 1px dashed #ccc;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            color: #666;\n            font-family: Arial, sans-serif;\n            font-size: 14px;\n        `,o.textContent=`Ad Space ${t}`,e.appendChild(o)}setupVideoAds(){this.core.on("video-player:initialized",(e=>{const{player:t}=e.detail;this.setupVideoPlayerAds(t)}));const e=this.core.getComponent("videoPlayer");e&&e.getAllPlayers().forEach((e=>{this.setupVideoPlayerAds(e)}))}setupVideoPlayerAds(e){if("mp4"!==e.type&&"self-hosted"!==e.type)return;e.element,e.container;this.setupPrerollAd(e),this.setupMidrollAds(e),this.setupPostrollAd(e),this.state.activeVideoAds.set(e.id,{player:e,prerollPlayed:!1,midrollsPlayed:[],postrollPlayed:!1})}setupPrerollAd(e){const t=e.container.querySelector(".preroll-ad");if(!t)return;const s=e.element;e.events.push(l(s,"play",(i=>{const o=this.state.activeVideoAds.get(e.id);o&&!o.prerollPlayed&&(i.preventDefault(),s.pause(),this.playPrerollAd(e,t))})))}async playPrerollAd(e,t){const s=this.state.activeVideoAds.get(e.id);if(s)try{t.style.display="block",t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.zIndex="10";const i=t.dataset.vastUrl;if(i&&this.state.vastClient)await this.playVastAd(i,t);else{const e=parseInt(t.dataset.duration)||5e3;await this.showStaticAd(t,e)}s.prerollPlayed=!0,t.style.display="none",e.element.play(),this.core.emit("ads:preroll-completed",{player:e})}catch(s){t.style.display="none",e.element.play()}}setupMidrollAds(e){const t=e.element,s=this.getMidrollTimes(e);0!==s.length&&e.events.push(l(t,"timeupdate",(()=>{this.checkMidrollTriggers(e,s)})))}getMidrollTimes(e){const t=e.container.dataset.midrollTimes;return t?t.split(",").map((e=>parseInt(e.trim()))):["50%"]}checkMidrollTriggers(e,t){const s=e.element,i=s.currentTime,o=s.duration,a=this.state.activeVideoAds.get(e.id);a&&o&&t.forEach(((t,s)=>{if(a.midrollsPlayed.includes(s))return;let n;if("string"==typeof t&&t.includes("%")){const e=parseInt(t)/100;n=o*e}else n=parseInt(t);i>=n&&(this.playMidrollAd(e,s),a.midrollsPlayed.push(s))}))}async playMidrollAd(e,t){const s=e.container.querySelector(".midroll-ad");if(s)try{e.element.pause(),await this.playPrerollAd(e,s),this.core.emit("ads:midroll-completed",{player:e,adIndex:t})}catch(e){}}setupPostrollAd(e){const t=e.container.querySelector(".postroll-ad");if(!t)return;const s=e.element;e.events.push(l(s,"ended",(()=>{this.playPostrollAd(e,t)})))}async playPostrollAd(e,t){const s=this.state.activeVideoAds.get(e.id);if(s&&!s.postrollPlayed)try{await this.playPrerollAd(e,t),s.postrollPlayed=!0,this.core.emit("ads:postroll-completed",{player:e})}catch(e){}}showStaticAd(e,t){return new Promise((s=>{const i=Math.min(5e3,t-1e3);let o;const a=setTimeout((()=>{o=document.createElement("button"),o.textContent="Skip Ad",o.className="ad-skip-button",o.style.cssText="\n                    position: absolute;\n                    top: 10px;\n                    right: 10px;\n                    padding: 5px 10px;\n                    background: rgba(0, 0, 0, 0.7);\n                    color: white;\n                    border: none;\n                    border-radius: 3px;\n                    cursor: pointer;\n                    z-index: 11;\n                ",e.appendChild(o),o.addEventListener("click",(()=>{clearTimeout(n),s()}))}),i),n=setTimeout((()=>{clearTimeout(a),o&&o.remove(),s()}),t)}))}async playVastAd(e,t){if(!this.state.vastClient)throw new Error("VAST client not available");try{await this.state.vastClient.get(e);return this.showStaticAd(t,15e3)}catch(e){return this.showStaticAd(t,5e3)}}setupHeaderAdSync(){if(0===this.elements.headerAds.length)return;this.core.getComponent("navigation")&&(this.syncHeaderAdDimensions(),this.events.push(l(window,"resize",i((()=>{this.syncHeaderAdDimensions()}),250)))),this.state.headerAdSynced=!0}syncHeaderAdDimensions(){const e=document.querySelector(".ph-nav");if(!e)return;const t=e.offsetHeight,s=e.offsetWidth;this.elements.headerAds.forEach((e=>{const i=Math.min(s-40,728),o=Math.min(t-20,90);e.style.maxWidth=i+"px",e.style.maxHeight=o+"px",e.style.overflow="hidden"})),this.core.emit("ads:header-sync-updated",{navHeight:t,navWidth:s})}setupResponsiveAds(){const e=()=>{const e=window.innerWidth;this.elements.adContainers.forEach((t=>{t.dataset.adType;const s=t.classList.contains("mobile-ad"),i=t.classList.contains("desktop-ad");e<=768?i?t.style.display="none":s&&(t.style.display="block"):s?t.style.display="none":i&&(t.style.display="block"),this.adjustAdSize(t,e)}))};e(),this.events.push(l(window,"resize",i(e,250)))}adjustAdSize(e,t){const s=e.dataset.adSize||"728x90";let i=s;if(t<=320?("728x90"===s&&(i="320x50"),"300x250"===s&&(i="300x250")):t<=768&&("728x90"===s&&(i="320x50"),"970x250"===s&&(i="728x90")),i!==s){const[t,s]=i.split("x").map(Number);e.style.width=t+"px",e.style.height=s+"px",e.dataset.currentSize=i}}setupAdVisibilityTracking(e){if("IntersectionObserver"in window){new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&this.trackAdVisibility(e.target)}))}),{threshold:.5}).observe(e)}}trackAdVisibility(e){const t=e.id||e.dataset.adId;t&&!this.state.adEvents.has(t)&&(this.state.adEvents.set(t,{viewTime:Date.now(),adType:e.dataset.adType,adNetwork:e.dataset.adNetwork}),this.core.emit("ads:ad-viewed",{adId:t,adType:e.dataset.adType,adNetwork:e.dataset.adNetwork}))}setupAdEventTracking(){this.elements.adContainers.forEach((e=>{this.events.push(l(e,"click",(t=>{t.target!==e&&this.trackAdClick(e)})))})),this.events.push(l(document,"visibilitychange",(()=>{document.hidden?this.pauseVideoAds():this.resumeVideoAds()})))}trackAdClick(e){const t=e.id||e.dataset.adId;this.core.emit("ads:ad-clicked",{adId:t,adType:e.dataset.adType,adNetwork:e.dataset.adNetwork,timestamp:Date.now()})}pauseVideoAds(){this.state.activeVideoAds.forEach((e=>{e.player.container.querySelectorAll('video[src*="ad"]').forEach((e=>e.pause()))}))}resumeVideoAds(){this.state.activeVideoAds.forEach((e=>{e.player.container.querySelectorAll('video[src*="ad"]').forEach((e=>{e.ended||e.play().catch((()=>{}))}))}))}loadScript(e,t){const s=document.createElement("script");s.src=e,s.async=!0,t&&(s.onload=t,s.onerror=()=>{}),document.head.appendChild(s)}loadAdLibraries(){document.querySelector("[data-vast-url]")&&this.loadScript("/assets/js/lib/vast-client.min.js",(()=>{window.VASTClient&&(this.state.vastClient=new window.VASTClient)}))}refreshAds(){window.googletag&&googletag.cmd.push((()=>{googletag.pubads().refresh()})),this.core.emit("ads:refresh-requested")}getAdMetrics(){return{totalAds:this.elements.adContainers.length,viewedAds:this.state.adEvents.size,activeVideoAds:this.state.activeVideoAds.size,headerAdSynced:this.state.headerAdSynced,adsLoaded:this.state.adsLoaded}}cleanup(){this.events.forEach((e=>e())),this.events=[],this.state.adEvents.clear(),this.state.activeVideoAds.clear(),this.state={adsLoaded:!1,headerAdSynced:!1,vastClient:null,adEvents:new Map,activeVideoAds:new Map}}}class g{constructor(e,t={}){e&&(this.container=e,this.options={slides:[],autoplay:!1,autoplayInterval:5e3,loop:!0,initialSlide:0,slidesToShow:1,scrollPerPage:!1,keyboard:!0,touch:!0,lazyLoad:!0,displayMode:"default",...t},this.elements={},this.state={currentSlide:this.options.initialSlide,totalSlides:this.options.slides.length,isPaused:!this.options.autoplay,isDragging:!1,startX:0,scrollLeft:0,autoplayTimer:null,intersectionObserver:null},this.events=[],this.init())}init(){0!==this.options.slides.length?(this.render(),this.cacheElements(),this.applyDisplayMode(),this.setupEventListeners(),this.setupLazyLoading(),this.options.autoplay&&!this.state.isPaused&&this.play(),this.goTo(this.state.currentSlide,!1)):this.container.innerHTML='<p class="carousel-empty-state">No slides available.</p>'}render(){this.container.classList.add("carousel-component"),this.container.setAttribute("role","region"),this.container.setAttribute("aria-label","Image Carousel"),this.container.innerHTML="";const e=document.createElement("div");e.className="carousel-track-container";const t=document.createElement("div");t.className="carousel-track",t.setAttribute("role","listbox"),this.options.slides.forEach(((e,s)=>{const i=document.createElement("div");i.className="carousel-slide",i.setAttribute("role","option"),i.setAttribute("aria-label",`Slide ${s+1} of ${this.options.slides.length}`),i.setAttribute("data-slide-index",s),i.innerHTML=this.renderSlideContent(e),t.appendChild(i)})),e.appendChild(t),this.container.appendChild(e);const s=document.createElement("button");s.className="carousel-button carousel-button-prev",s.setAttribute("aria-label","Previous slide"),s.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>',this.container.appendChild(s);const i=document.createElement("button");i.className="carousel-button carousel-button-next",i.setAttribute("aria-label","Next slide"),i.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>',this.container.appendChild(i);const o=document.createElement("div");o.className="carousel-pagination",this.container.appendChild(o)}renderSlideContent(e){return"video"===e.type&&e.videoUrl?`\n                <video class="carousel-slide-media" data-src="${e.videoUrl}" muted playsinline preload="none" loop></video>\n                <div class="carousel-slide-content">\n                    ${e.title?`<h3 class="carousel-slide-title">${e.title}</h3>`:""}\n                    ${e.description?`<p class="carousel-slide-description">${e.description}</p>`:""}\n                    ${e.buttonText&&e.buttonUrl?`<a href="${e.buttonUrl}" class="carousel-slide-button">${e.buttonText}</a>`:""}\n                </div>\n            `:e.imageUrl?`\n                <img class="carousel-slide-media" data-src="${e.imageUrl}" alt="${e.title||"Carousel slide"}">\n                <div class="carousel-slide-content">\n                    ${e.title?`<h3 class="carousel-slide-title">${e.title}</h3>`:""}\n                    ${e.description?`<p class="carousel-slide-description">${e.description}</p>`:""}\n                    ${e.buttonText&&e.buttonUrl?`<a href="${e.buttonUrl}" class="carousel-slide-button">${e.buttonText}</a>`:""}\n                </div>\n            `:`\n                <div class="carousel-slide-content">\n                    ${e.title?`<h3 class="carousel-slide-title">${e.title}</h3>`:""}\n                    ${e.description?`<p class="carousel-slide-description">${e.description}</p>`:""}\n                    ${e.buttonText&&e.buttonUrl?`<a href="${e.buttonUrl}" class="carousel-slide-button">${e.buttonText}</a>`:""}\n                </div>\n            `}cacheElements(){this.elements={trackContainer:this.container.querySelector(".carousel-track-container"),track:this.container.querySelector(".carousel-track"),slides:Array.from(this.container.querySelectorAll(".carousel-slide")),prevButton:this.container.querySelector(".carousel-button-prev"),nextButton:this.container.querySelector(".carousel-button-next"),pagination:this.container.querySelector(".carousel-pagination")},this.createPaginationDots()}applyDisplayMode(){this.container.classList.add(`carousel-mode-${this.options.displayMode}`),this.options.slidesToShow>1&&this.container.style.setProperty("--carousel-slides-to-show",this.options.slidesToShow)}createPaginationDots(){if(this.elements.pagination){this.elements.pagination.innerHTML="";for(let e=0;e<this.state.totalSlides;e++){const t=document.createElement("button");t.classList.add("carousel-pagination-dot"),t.setAttribute("aria-label",`Go to slide ${e+1}`),t.setAttribute("data-slide-index",e),this.elements.pagination.appendChild(t),this.events.push(l(t,"click",(()=>this.goTo(e))))}}}setupEventListeners(){this.events.forEach((e=>e())),this.events=[],this.elements.prevButton&&this.events.push(l(this.elements.prevButton,"click",(()=>this.prev()))),this.elements.nextButton&&this.events.push(l(this.elements.nextButton,"click",(()=>this.next()))),this.options.keyboard&&this.events.push(l(document,"keydown",this.handleKeyboard.bind(this))),this.options.touch&&this.elements.trackContainer&&(this.events.push(l(this.elements.trackContainer,"mousedown",this.handleDragStart.bind(this),{passive:!0})),this.events.push(l(this.elements.trackContainer,"mouseleave",this.handleDragEnd.bind(this),{passive:!0})),this.events.push(l(this.elements.trackContainer,"mouseup",this.handleDragEnd.bind(this),{passive:!0})),this.events.push(l(this.elements.trackContainer,"mousemove",this.handleDragMove.bind(this),{passive:!0})),this.events.push(l(this.elements.trackContainer,"touchstart",this.handleDragStart.bind(this),{passive:!0})),this.events.push(l(this.elements.trackContainer,"touchend",this.handleDragEnd.bind(this),{passive:!0})),this.events.push(l(this.elements.trackContainer,"touchmove",this.handleDragMove.bind(this),{passive:!0}))),this.options.autoplay&&(this.events.push(l(this.container,"mouseenter",(()=>this.pause()))),this.events.push(l(this.container,"mouseleave",(()=>this.play())))),this.events.push(l(window,"resize",i((()=>this.goTo(this.state.currentSlide,!1)),250)))}handleKeyboard(e){(this.container.contains(document.activeElement)||this.container===document.activeElement)&&("ArrowLeft"===e.key?this.prev():"ArrowRight"===e.key&&this.next())}handleDragStart(e){this.state.isDragging=!0,this.elements.trackContainer.classList.add("dragging"),this.state.startX=(e.pageX||e.touches[0].pageX)-this.elements.trackContainer.offsetLeft,this.state.scrollLeft=this.elements.trackContainer.scrollLeft,cancelAnimationFrame(this.state.autoplayTimer)}handleDragMove(e){if(!this.state.isDragging)return;const t=1.5*((e.pageX||e.touches[0].pageX)-this.elements.trackContainer.offsetLeft-this.state.startX);this.elements.trackContainer.scrollLeft=this.state.scrollLeft-t}handleDragEnd(){this.state.isDragging=!1,this.elements.trackContainer.classList.remove("dragging"),this.options.autoplay&&this.state.isPaused&&this.play(),this.options.scrollPerPage||this.snapToNearestSlide()}snapToNearestSlide(){const e=this.elements.trackContainer.scrollLeft,t=this.elements.slides[0].offsetWidth,s=Math.round(e/t);this.goTo(s)}goTo(e,t=!0){let s=e;s=this.options.loop?(e+this.state.totalSlides)%this.state.totalSlides:Math.max(0,Math.min(e,this.state.totalSlides-this.options.slidesToShow)),this.state.currentSlide=s;const i=s*this.elements.slides[0].offsetWidth;this.elements.trackContainer.scrollTo({left:i,behavior:t?"smooth":"auto"}),this.updateActiveState(),this.loadVisibleSlides(),this.emit("slideChange",{currentSlide:this.state.currentSlide})}next(){const e=this.state.currentSlide+(this.options.scrollPerPage?this.options.slidesToShow:1);this.goTo(e)}prev(){const e=this.state.currentSlide-(this.options.scrollPerPage?this.options.slidesToShow:1);this.goTo(e)}pause(){this.state.autoplayTimer&&(clearInterval(this.state.autoplayTimer),this.state.autoplayTimer=null,this.state.isPaused=!0,this.emit("pause"))}play(){this.options.autoplay&&this.state.isPaused&&(this.state.autoplayTimer=setInterval((()=>{this.next()}),this.options.autoplayInterval),this.state.isPaused=!1,this.emit("play"))}updateActiveState(){this.elements.slides.forEach(((e,t)=>{t>=this.state.currentSlide&&t<this.state.currentSlide+this.options.slidesToShow?(e.classList.add("is-active"),e.setAttribute("aria-hidden","false")):(e.classList.remove("is-active"),e.setAttribute("aria-hidden","true"))})),Array.from(this.elements.pagination.children).forEach(((e,t)=>{t===this.state.currentSlide?e.classList.add("is-active"):e.classList.remove("is-active")})),this.options.loop||(this.elements.prevButton&&(this.elements.prevButton.disabled=0===this.state.currentSlide),this.elements.nextButton&&(this.elements.nextButton.disabled=this.state.currentSlide>=this.state.totalSlides-this.options.slidesToShow))}setupLazyLoading(){this.state.intersectionObserver&&this.state.intersectionObserver.disconnect(),this.options.lazyLoad&&"IntersectionObserver"in window?(this.state.intersectionObserver=new IntersectionObserver(((e,t)=>{e.forEach((e=>{e.isIntersecting&&(this.loadSlideMedia(e.target),t.unobserve(e.target))}))}),{root:this.elements.trackContainer,rootMargin:"0px",threshold:.1}),this.elements.slides.forEach((e=>{this.state.intersectionObserver.observe(e)}))):this.loadAllSlides()}loadSlideMedia(e){const t=e.querySelector(".carousel-slide-media");t&&t.dataset.src&&(t.src=t.dataset.src,t.removeAttribute("data-src"),t.classList.add("is-loaded"),"VIDEO"===t.tagName&&(t.load(),e.classList.contains("is-active")&&t.play().catch((e=>{}))),this.emit("slideMediaLoaded",{slideElement:e}))}loadAllSlides(){this.elements.slides.forEach((e=>this.loadSlideMedia(e)))}loadVisibleSlides(){this.elements.slides.forEach(((e,t)=>{t>=this.state.currentSlide&&t<this.state.currentSlide+this.options.slidesToShow&&this.loadSlideMedia(e)}))}updateSlides(e,t=0){this.pause(),this.options.slides=e,this.state.totalSlides=e.length,this.state.currentSlide=t,this.render(),this.cacheElements(),this.setupEventListeners(),this.setupLazyLoading(),this.goTo(this.state.currentSlide,!1),this.options.autoplay&&this.play(),this.emit("slides-updated",{carouselId:this.container.id,newSlides:e})}emit(e,t={}){this.container.dispatchEvent(new CustomEvent(`carousel:${e}`,{detail:t}))}on(e,t){this.container.addEventListener(`carousel:${e}`,t)}off(e,t){this.container.removeEventListener(`carousel:${e}`,t)}cleanup(){this.pause(),this.events.forEach((e=>e())),this.events=[],this.state.intersectionObserver&&(this.state.intersectionObserver.disconnect(),this.state.intersectionObserver=null),this.container.innerHTML="",this.container.classList.remove("carousel-component",`carousel-mode-${this.options.displayMode}`),this.container.removeAttribute("role"),this.container.removeAttribute("aria-label")}}window.customtubeBundleLoaded=!0;class b{constructor(){this.core=new d,this.components=new Map,this.pageModules=new Map,this.isInitialized=!1}async init(){if(!this.isInitialized)try{await this.core.init(),await this.initializeGlobalComponents(),await this.initializePageSpecificModules(),this.setupGlobalEventListeners(),this.isInitialized=!0,this.core.emit("app:initialized",{components:Array.from(this.components.keys()),pageModules:Array.from(this.pageModules.keys()),currentPage:this.core.state.currentPage})}catch(e){this.core.emit("app:initialization-failed",{error:e})}}async initializeGlobalComponents(){if(document.querySelector(".ph-nav")){const e=new h(this.core);e.init(),this.components.set("navigation",e)}if(document.querySelector(".ph-nav__theme-toggle, #theme-toggle")){const e=new u(this.core);e.init(),this.components.set("themeSwitcher",e)}if(document.querySelector(".video-player-container")){const e=new m(this.core);e.init(),this.components.set("videoPlayer",e)}if(document.querySelector(".video-grid, .video-masonry, .video-grid-container")){const e=new p(this.core);e.init(),this.components.set("videoGrid",e)}if(document.querySelector(".video-thumbnail-container, .video-card")){const e=new v(this.core);e.init(),this.components.set("enhancedFeatures",e)}if(document.querySelector(".ad-container, .banner-ad, .video-ad-container")){const e=new y(this.core);e.init(),this.components.set("adsManager",e)}const e=document.querySelectorAll("[data-carousel]");e.length>0&&e.forEach(((e,t)=>{const s=e.id||`carousel-${t}`,i=JSON.parse(e.dataset.carouselOptions||"{}");if(!i.slides||0===i.slides.length){const e=window.customtubeData.theme_uri+"/assets/images/default-video.jpg";i.slides=[{type:"image",imageUrl:e,title:"Awesome Slide 1",description:"This is a description for slide 1.",buttonText:"Watch Now",buttonUrl:"#"},{type:"image",imageUrl:e,title:"Amazing Slide 2",description:"This is a description for slide 2.",buttonText:"Learn More",buttonUrl:"#"},{type:"video",videoUrl:"https://www.w3schools.com/html/mov_bbb.mp4",title:"Video Slide 3",description:"A short video clip.",buttonText:"Play Video",buttonUrl:"#"},{type:"image",imageUrl:e,title:"Fantastic Slide 4",description:"Another great slide.",buttonText:"Discover",buttonUrl:"#"}]}const o=new g(e,i);this.components.set(`carousel-${s}`,o)}))}async initializePageSpecificModules(){switch(this.core.state.currentPage){case"home":await this.initializeHomePage();break;case"video-single":await this.initializeVideoSinglePage();break;case"performers":await this.initializePerformersPage();break;case"login":case"register":await this.initializeAuthPages();break;case"liked-videos":await this.initializeLikedVideosPage();break;case"short-videos":await this.initializeShortVideosPage();break;case"trending":await this.initializeTrendingPage()}}async initializeHomePage(){this.setupHomepageFeatures(),await this.fetchAndDisplayPersonalizedCarousels(),this.core.on("enhanced-features:card-activated",debounce((()=>{this.updatePersonalizedCarousels()}),1e3))}async fetchAndDisplayPersonalizedCarousels(){const e=this.getComponent("enhancedFeatures"),t=e?e.getWatchedVideos():[];if(document.querySelector("#hero-carousel"))try{const e=await this.core.ajax.getPersonalizedRecommendations(t,5,"hero"),s=this.components.get("carousel-hero-main");s&&s.updateSlides(e)}catch(e){}if(document.querySelector("#because-you-watched-carousel"))try{const e=await this.core.ajax.getPersonalizedRecommendations(t,6,"because_you_watched"),s=this.components.get("carousel-because-you-watched");s&&s.updateSlides(e)}catch(e){}if(document.querySelector("#you-might-also-like-carousel"))try{const e=await this.core.ajax.getPersonalizedRecommendations(t,6,"you_might_also_like"),s=this.components.get("carousel-you-might-also-like");s&&s.updateSlides(e)}catch(e){}}async updatePersonalizedCarousels(){const e=this.getComponent("enhancedFeatures"),t=e?e.getWatchedVideos():[];if(document.querySelector("#because-you-watched-carousel"))try{const e=await this.core.ajax.getPersonalizedRecommendations(t,6,"because_you_watched"),s=this.components.get("carousel-because-you-watched");s&&s.updateSlides(e)}catch(e){}if(document.querySelector("#you-might-also-like-carousel"))try{const e=await this.core.ajax.getPersonalizedRecommendations(t,6,"you_might_also_like"),s=this.components.get("carousel-you-might-also-like");s&&s.updateSlides(e)}catch(e){}}async initializeVideoSinglePage(){this.setupVideoPageFeatures()}async initializePerformersPage(){this.setupPerformersPageFeatures()}async initializeAuthPages(){this.setupAuthPageFeatures()}async initializeLikedVideosPage(){this.setupLikedVideosFeatures()}async initializeShortVideosPage(){this.setupShortVideosFeatures()}async initializeTrendingPage(){const e=document.querySelector("#trending-carousel");if(e){const t=window.customtubeData.theme_uri+"/assets/images/default-video.jpg",s=new g(e,{slides:[{type:"image",imageUrl:t,title:"Top Trending Video 1",description:"This is the hottest video right now!",buttonText:"Watch Now",buttonUrl:"#"},{type:"image",imageUrl:t,title:"Viral Sensation 2",description:"Don't miss this one!",buttonText:"Check it out",buttonUrl:"#"},{type:"video",videoUrl:"https://www.w3schools.com/html/mov_bbb.mp4",title:"Trending Video 3",description:"A must-watch clip.",buttonText:"Play",buttonUrl:"#"}],autoplay:!0,loop:!0,displayMode:"full-width-hero"});this.components.set("trendingHeroCarousel",s)}}setupHomepageFeatures(){const e=document.querySelector(".trending-section");e&&this.setupTrendingSection(e);const t=document.querySelector(".category-navigation");t&&this.setupCategoryNavigation(t);const s=document.querySelector("#hero-carousel");if(s&&!this.components.has("carousel-hero-main")){const e=window.customtubeData.theme_uri+"/assets/images/default-video.jpg",t=new g(s,{slides:[{type:"image",imageUrl:e,title:"Welcome to CustomTube",description:"Discover amazing videos!",buttonText:"Explore",buttonUrl:"#"},{type:"image",imageUrl:e,title:"New Content Daily",description:"Never miss a moment.",buttonText:"Browse",buttonUrl:"#"}],autoplay:!0,loop:!0,displayMode:"full-width-hero"});this.components.set("carousel-hero-main",t)}const i=document.querySelector("#because-you-watched-carousel");if(i&&!this.components.has("carousel-because-you-watched")){const e=new g(i,{slidesToShow:4,loop:!1,displayMode:"multi-row-strip"});this.components.set("carousel-because-you-watched",e)}const o=document.querySelector("#you-might-also-like-carousel");if(o&&!this.components.has("carousel-you-might-also-like")){const e=new g(o,{slidesToShow:4,loop:!1,displayMode:"multi-row-strip"});this.components.set("carousel-you-might-also-like",e)}}setupVideoPageFeatures(){const e=document.querySelector(".video-recommendations");e&&this.setupVideoRecommendations(e);const t=document.querySelector(".video-like-button");t&&this.setupLikeButton(t)}setupPerformersPageFeatures(){const e=document.querySelector(".performers-alphabet-nav");e&&this.setupAlphabetNavigation(e)}setupAuthPageFeatures(){const e=document.querySelector(".login-form"),t=document.querySelector(".register-form");e&&this.setupLoginForm(e),t&&this.setupRegisterForm(t)}setupLikedVideosFeatures(){document.querySelector(".liked-videos-container")&&this.loadLikedVideos()}setupShortVideosFeatures(){document.querySelector(".short-videos-container")&&this.loadShortVideos()}setupTrendingSection(e){const t=e.querySelector(".load-trending");t&&t.addEventListener("click",(async()=>{try{const t=await this.core.ajax.getTrendingVideos();t.success&&this.updateTrendingContent(e,t.data.videos)}catch(e){}}))}setupCategoryNavigation(e){e.querySelectorAll("a[data-category]").forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault();const s=e.dataset.category||e.textContent.trim();this.filterByCategory(s)}))}))}setupVideoRecommendations(e){const t=e.dataset.videoId;t&&this.loadVideoRecommendations(t,e)}setupLikeButton(e){e.addEventListener("click",(async t=>{t.preventDefault();const s=e.dataset.videoId;if(s)try{const t=await this.core.ajax.toggleLike(s);t.success&&this.updateLikeButton(e,t.data)}catch(e){}}))}setupAlphabetNavigation(e){e.querySelectorAll('a[href^="#letter-"]').forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault();const s=e.getAttribute("href"),i=document.querySelector(s);i&&i.scrollIntoView({behavior:"smooth",block:"start"})}))}))}setupLoginForm(e){e.addEventListener("submit",(async t=>{t.preventDefault();const s=new FormData(e),i=s.get("log"),o=s.get("pwd"),a="1"===s.get("rememberme");try{const t=await this.core.ajax.userLogin(i,o,a);t.success?window.location.href=t.data.redirect_url||"/":this.showFormError(e,t.data.message)}catch(t){this.showFormError(e,"Login failed. Please try again.")}}))}setupRegisterForm(e){e.addEventListener("submit",(async t=>{t.preventDefault();const s=new FormData(e),i=Object.fromEntries(s.entries());try{const t=await this.core.ajax.userRegister(i);t.success?(this.showFormSuccess(e,t.data.message),setTimeout((()=>{window.location.href=t.data.redirect_url||"/login"}),2e3)):this.showFormError(e,t.data.message)}catch(t){this.showFormError(e,"Registration failed. Please try again.")}}))}async loadLikedVideos(){try{const e=await this.core.ajax.getLikedVideos();e.success&&this.updateLikedVideosContent(e.data.videos)}catch(e){}}async loadShortVideos(){try{const e=await this.core.ajax.getShortVideos();e.success&&this.updateShortVideosContent(e.data.videos)}catch(e){}}setupGlobalEventListeners(){this.core.on("error:global",(e=>{})),this.core.on("breakpoint:changed",(e=>{this.components.forEach((t=>{t&&"function"==typeof t.handleBreakpointChange&&t.handleBreakpointChange(e.detail)}))})),document.addEventListener("visibilitychange",(()=>{const e=!document.hidden;this.core.emit("page:visibility-changed",{isVisible:e})})),window.addEventListener("beforeunload",(()=>{this.cleanup()})),this.core.on("content:loaded",(()=>{this.reinitializeComponents()}))}reinitializeComponents(){this.components.forEach((e=>{e&&"function"==typeof e.reinitialize&&e.reinitialize()}))}updateTrendingContent(e,t){e.querySelector(".trending-videos")&&t&&this.core.emit("content:updated",{section:"trending",videos:t})}filterByCategory(e){const t=this.getComponent("videoGrid");t&&t.applyFilter("category",e)}async loadVideoRecommendations(e,t){try{const t=await this.core.ajax.getRecommendations(e);t.success&&this.core.emit("content:updated",{section:"recommendations",videos:t.data})}catch(e){}}updateLikeButton(e,t){e.classList.toggle("liked",t.liked);const s=e.querySelector(".like-count");s&&(s.textContent=t.likes_count)}updateLikedVideosContent(e){document.querySelector(".liked-videos-container")&&this.core.emit("content:updated",{section:"liked-videos",videos:e})}updateShortVideosContent(e){document.querySelector(".short-videos-container")&&this.core.emit("content:updated",{section:"short-videos",videos:e})}showFormError(e,t){let s=e.querySelector(".form-error");s||(s=document.createElement("div"),s.className="form-error",e.insertBefore(s,e.firstChild)),s.textContent=t,s.style.display="block"}showFormSuccess(e,t){let s=e.querySelector(".form-success");s||(s=document.createElement("div"),s.className="form-success",e.insertBefore(s,e.firstChild)),s.textContent=t,s.style.display="block"}getComponent(e){return this.components.get(e)||null}getPageModule(e){return this.pageModules.get(e)||null}getState(){return{isInitialized:this.isInitialized,currentPage:this.core.state.currentPage,components:Array.from(this.components.keys()),pageModules:Array.from(this.pageModules.keys()),breakpoint:this.core.state.currentBreakpoint,isMobile:this.core.state.isMobile}}async reinitialize(){this.cleanup(),this.isInitialized=!1,await this.init()}cleanup(){this.components.forEach(((e,t)=>{if(e&&"function"==typeof e.cleanup)try{e.cleanup()}catch(e){}})),this.pageModules.forEach(((e,t)=>{if(e&&"function"==typeof e.cleanup)try{e.cleanup()}catch(e){}})),this.core&&"function"==typeof this.core.cleanup&&this.core.cleanup(),this.components.clear(),this.pageModules.clear(),this.isInitialized=!1}}function f(){window.CustomTube=new b,window.CustomTube.init().catch((e=>{}))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",f):f();var w=b;return t=t.default}()}));